---
layout: post
title: ESP8266ç½‘é¡µæ˜¾ç¤ºæ¸©æ¹¿åº¦æ›²çº¿
subtitle: There's lots to learn!
gh-repo: wildfireburning
gh-badge: [star, fork, follow]
thumbnail-img: /assets/img/thumb3.png
tags: [study]
comments: true
mathjax: true
author: LiHuihua
---


![æ•ˆæœå±•ç¤º](/assets/img/post3_1.png)

æœ¬é¡¹ç›®å‚è€ƒäº†è¿™ç¯‡æ–‡ç« ï¼š[ESP32/ESP8266 Plot Sensor Readings in Real Time Charts â€“ Web Server](https://randomnerdtutorials.com/esp32-esp8266-plot-chart-web-server/)

è¿™ä¸ªé¡¹ç›®çš„çµæ„Ÿæ¥æºäºå•ç‰‡æœºè¯¾ç¨‹è®¾è®¡ï¼Œæˆ‘åšäº†ä¸€ä¸ªå°†æ¸©æ¹¿åº¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°çš„ç³»ç»Ÿã€‚ä¸­æœŸæ±‡æŠ¥çš„æ—¶å€™ï¼Œè€å¸ˆè¯´ï¼Œä¸ºä»€ä¹ˆä¸åŒæ—¶æŠŠæ¸©æ¹¿åº¦æ›²çº¿å±•ç°å‡ºæ¥å‘¢ï¼Ÿå—¯...æˆ‘ä¹Ÿæƒ³ã€‚ä½†æ˜¯é˜¿é‡Œäº‘ä¸èƒ½åŒæ—¶å±•ç¤ºç°åœ¨çš„æ¸©æ¹¿åº¦å’Œå†å²æ›²çº¿ï¼Œéœ€è¦æ‰‹åŠ¨ç‚¹å‡»ï¼Œå±•ç¤ºæ›²çº¿çš„é¡µé¢ä¹Ÿä¸ç¾è§‚ã€‚è€Œä¸”é˜¿é‡Œäº‘åŠŸèƒ½æ¯”è¾ƒå¤šï¼Œç•Œé¢ä¸ç®€æ´ï¼Œä½†æˆ‘ä»¬åªéœ€è¦å…¶ä¸­å¾ˆå°‘ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚

ç”¨ç½‘é¡µå±•ç¤ºæ¸©æ¹¿åº¦çš„æƒ³æ³•ï¼Œæ˜¯æˆ‘çš„ç”·æœ‹å‹å°ç‹åŒå­¦æå‡ºçš„ğŸ˜½ã€‚è‡ªå·±å†™çš„ç½‘é¡µæœ‰æ¯”è¾ƒå¤§çš„è‡ªç”±åº¦ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®¡ç¾ä¿®æ”¹ï¼Œç•Œé¢æ›´ç®€æ´ã€‚ä½†æ˜¯åˆ°äº†ç”»æ›²çº¿çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¡ä½äº†ï¼Œç”»æ›²çº¿éœ€è¦ç”¨åˆ°Java Scriptçš„åº“ï¼Œæˆ‘ä»¬å¯¹æ­¤ä¸ç†Ÿæ‚‰ã€‚äºæ˜¯æˆ‘ä¸Šç½‘æ‰¾äº†ç¯‡æ–‡ç« ï¼Œæ ¹æ®éœ€è¦æ”¹åŠ¨äº†ä¸€ä¸‹ã€‚

---

## **ç”¨åˆ°çš„ä¸œè¥¿**

 ç¡¬ä»¶ï¼š
- ESP8266-01S
- USB-TTL
- DHT11

 è½¯ä»¶ï¼š
- Arduino

***

## **æ­¥éª¤**

#### 1. **Arduinoå®‰è£…ESP8266çš„åŒ…**

åœ¨Arduinoçš„æ–‡ä»¶-é¦–é€‰é¡¹-å…¶ä»–å¼€å‘æ¿ç®¡ç†å™¨åœ°å€ä¸­ï¼Œç²˜è´´æ­¤é“¾æ¥ï¼šhttp://arduino.esp8266.com/stable/package_esp8266com_index.json

![å®‰è£…åŒ…](/assets/img/post3_2.png)

***

#### 2. **åœ¨Arduinoä¸­é€‰æ‹©ä½ çš„æ¿å­**

æˆ‘ä½¿ç”¨çš„æ˜¯ESP8266-01Sï¼Œæ‰€ä»¥åœ¨å¼€å‘æ¿è¿™é‡Œé€‰æ‹©çš„æ˜¯Generic ESP8266 Moduleï¼Œé€šç”¨ESP8266æ¨¡å—ã€‚å¦‚æœä½¿ç”¨ESP8266-12ï¼Œå¯ä»¥é€‰æ‹©Generic ESP8266 Moduleï¼Œä¹Ÿå¯ä»¥é€‰æ‹©Node MCUã€‚

![é€‰æ‹©ä½ çš„æ¿å­](/assets/img/post3_3.png)

***

#### 3. **Arduinoå®‰è£…åº“**
   
å¦‚æœæ˜¯**ESP32**ï¼Œåœ¨Libraryä¸­æœç´¢å¹¶å®‰è£…è¿™äº›åº“  

```
<WiFi.h>  
<ESPAsyncWebServer.h>  
```

 å¦‚æœæ˜¯**ESP8266**ï¼Œåœ¨Libraryä¸­æœç´¢å¹¶å®‰è£…è¿™äº›åº“  

```
<ESP8266WiFi.h>  
<Hash.h>  
<ESPAsyncTCP.h>  
<ESPAsyncWebServer.h>  
```

 DHT11ä½¿ç”¨çš„åº“ï¼š  

```
<DHT11.h>
``` 

***

#### 4. **ä½¿ç”¨LittleFSå‚¨å­˜ç½‘é¡µæ–‡ä»¶**

ä¸€å¼€å§‹æˆ‘å°è¯•ç›´æ¥åœ¨Arduinoçš„æ–‡ä»¶é‡Œå†™ç½‘é¡µï¼Œä½†æ˜¯ç½‘é¡µä»£ç é‡å¤ªå¤§äº†ï¼Œè€ŒESP8266çš„å†…å­˜æ¯”è¾ƒå°ï¼Œåªæ˜¯å†™å†™å¾ˆç®€å•çš„ç½‘é¡µè¿˜æ˜¯å¯ä»¥çš„ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦å±•ç¤ºæ›²çº¿ã€‚äºæ˜¯ç›´æ¥æŠŠæ•´ä¸ªç½‘é¡µæ–‡ä»¶æ”¾åœ¨LittleFSé‡Œã€‚åªéœ€è¦åœ¨å¼€å¤´åŠ ä¸Šä¸€å¥  
```
#include <LittleFS.h>
```
å°±å¯ä»¥è¯»å–äº†  

##### **å®‰è£…LittleFSä¸Šä¼ æ’ä»¶**

ç‚¹è¿›è¿™ä¸ªç½‘ç«™ï¼š[arduino-littlefs-upload](https://github.com/earlephilhower/arduino-littlefs-upload/releases)  
ä¸‹è½½vsixæ–‡ä»¶  

![ä¸‹è½½æ’ä»¶](/assets/img/post3_4.png)

æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°.arduinoIDEè¿™ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬æ”¾åœ¨è¿™ä¸ªåœ°æ–¹ï¼š  
```
C:\Users\YourUserName\.arduinoIDE
```  
*YourUserNameæ˜¯ä½ è‡ªå·±èµ·çš„åå­—

ç„¶ååˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‘½åä¸ºplugins  

![åˆ›å»ºpluginsæ–‡ä»¶å¤¹](/assets/img/post3_5.png)  

æŠŠåˆšåˆšä¸‹è½½çš„vsixæ–‡ä»¶æ”¾è¿›plugins  

![å®‰è£…æ’ä»¶](/assets/img/post3_6.png)  

é‡å¯Arduinoï¼ŒæŒ‰ä½Ctrl+Shift+Pï¼Œè¾“å…¥Upload LittleFS  
å‡ºç°äº†è¿™ä¸ªé€‰é¡¹çš„è¯æ’ä»¶å°±å®‰è£…æˆåŠŸå•¦  

![å‡ºç°é€‰é¡¹](/assets/img/post3_7.png)  

æ‰“å¼€å·¥ç¨‹æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ˜¯æ”¾ä½ çš„inoæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œåœ¨ä½ çš„inoæ–‡ä»¶æ—è¾¹æ–°å»ºä¸€ä¸ªdataæ–‡ä»¶å¤¹  

![åˆ›å»ºdata](/assets/img/post3_8.png)  

ç„¶ååœ¨dataæ–‡ä»¶å¤¹é‡Œé¢æ–°å»ºä¸€ä¸ªç½‘é¡µæ–‡ä»¶index.html  
å†™å…¥htmlå’Œjsä»£ç   

```html

<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ¸©æ¹¿åº¦ç›‘æµ‹</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }

    h1 {
      font-family: Arial;
      font-size: 2.5rem;
      text-align: center;
    }

    .data-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 150px;
      /* æ§åˆ¶å·¦å³ä¹‹é—´çš„é—´è· */
      margin-bottom: 20px;
    }

    .data {
      font-size: 2em;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <h1>ESP Environment Station</h1>

  <!-- æ¸©åº¦å’Œæ¹¿åº¦å¹¶æ’æ˜¾ç¤º -->
  <div class="data-container">
    <p class="data" id="current-temperature">Temperature: -- â„ƒ</p>
    <p class="data" id="current-humidity">Humidity: -- %RH</p>
  </div>

  <!-- æ¸©åº¦å’Œæ¹¿åº¦å›¾è¡¨ -->
  <div id="chart-temperature" class="container"></div>
  <div id="chart-humidity" class="container"></div>

  <script>
    // æ¸©åº¦å›¾è¡¨
    var chartT = new Highcharts.Chart({
      chart: { renderTo: 'chart-temperature' },
      title: { text: 'Temperature' },
      series: [{
        showInLegend: false,
        data: []
      }],
      plotOptions: {
        line: {
          animation: false,
          dataLabels: { enabled: true }
        },
        series: { color: '#059e8a' }
      },
      xAxis: {
        type: 'datetime',
        dateTimeLabelFormats: { second: '%H:%M:%S' }
      },
      yAxis: {
        title: { text: 'Temperature (Celsius)' }
      },
      credits: { enabled: false }
    });

    // æ¯éš”30ç§’è·å–ä¸€æ¬¡æ¸©åº¦æ•°æ®å¹¶æ›´æ–°å›¾è¡¨å’Œæ˜¾ç¤ºçš„æ¸©åº¦
    setInterval(function () {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          var x = (new Date()).getTime() + (8 * 60 * 60 * 1000); // åŠ ä¸Š8å°æ—¶çš„æ—¶åŒºå·®
          var y = parseFloat(this.responseText);

          // æ›´æ–°æ˜¾ç¤ºçš„æ¸©åº¦
          document.getElementById("current-temperature").innerHTML = "Temperature: " + y.toFixed(2) + " â„ƒ";

          if (chartT.series[0].data.length > 40) {
            chartT.series[0].addPoint([x, y], true, true, true);
          } else {
            chartT.series[0].addPoint([x, y], true, false, true);
          }
        }
      };
      xhttp.open("GET", "/temperature", true);
      xhttp.send();
    }, 30000);

    // æ¹¿åº¦å›¾è¡¨
    var chartH = new Highcharts.Chart({
      chart: { renderTo: 'chart-humidity' },
      title: { text: 'Humidity' },
      series: [{
        showInLegend: false,
        data: []
      }],
      plotOptions: {
        line: {
          animation: false,
          dataLabels: { enabled: true }
        }
      },
      xAxis: {
        type: 'datetime',
        dateTimeLabelFormats: { second: '%H:%M:%S' }
      },
      yAxis: {
        title: { text: 'Humidity (%)' }
      },
      credits: { enabled: false }
    });

    // æ¯éš”30ç§’è·å–ä¸€æ¬¡æ¹¿åº¦æ•°æ®å¹¶æ›´æ–°å›¾è¡¨å’Œæ˜¾ç¤ºçš„æ¹¿åº¦
    setInterval(function () {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          var x = (new Date()).getTime() + (8 * 60 * 60 * 1000); // åŠ ä¸Š8å°æ—¶çš„æ—¶åŒºå·®
          var y = parseFloat(this.responseText);

          // æ›´æ–°æ˜¾ç¤ºçš„æ¹¿åº¦
          document.getElementById("current-humidity").innerHTML = "Humidity: " + y.toFixed(2) + " %RH";

          if (chartH.series[0].data.length > 40) {
            chartH.series[0].addPoint([x, y], true, true, true);
          } else {
            chartH.series[0].addPoint([x, y], true, false, true);
          }
        }
      };
      xhttp.open("GET", "/humidity", true);
      xhttp.send();
    }, 30000);

  </script>

</body>

</html>

```

Highcharts æ˜¯ä¸€ä¸ªå›¾è¡¨åº“ï¼Œä¸“é—¨ç”¨äºåœ¨ç½‘é¡µä¸­ç»˜åˆ¶å„ç§å›¾è¡¨ã€‚  
`<script src="https://code.highcharts.com/highcharts.js"></script>`  
è¿™è¡Œä»£ç ä» Highcharts çš„ CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰åŠ è½½ Highcharts åº“ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨ç½‘é¡µä¸­ä½¿ç”¨è¿™ä¸ªJavaScriptåº“æ¥åˆ›å»ºå›¾è¡¨ã€‚

##### **æŠŠç½‘é¡µæ–‡ä»¶ä¸Šä¼ åˆ°ESP8266çš„LittleFS**  

è¿æ¥ESP8266å’ŒUSB-TTLï¼Œå¹¶è®¾ç½®æˆä¸‹è½½æ¨¡å¼ï¼ŒRSTè¦æ¥ä¸€ä¸‹åœ°å†æ¥3V3  

| ESP8266     | USB-TTL |
| :-----------: | :-----------: |
| RX      | TXD       |
| TX   | RXD        |
| EN   | 3V3        |
| VCC   | 3V3        |
| GND   | GND        |  
| GPIO0   | GND        |
| RST   | 3V3        |

æ‰“å¼€Arduinoï¼ŒæŒ‰ä½Ctrl+Shift+Pï¼Œè¾“å…¥Upload LittleFS  
ç‚¹å‡»å‡ºç°çš„é€‰é¡¹  

![å‡ºç°é€‰é¡¹](/assets/img/post3_7.png)  

çƒ§å½•æˆåŠŸå¦‚å›¾  

![çƒ§å½•æˆåŠŸ](/assets/img/post3_9.png)

å¦‚æœä¸€ç›´å¡åœ¨`Connecting...â€”â€”â€”â€”...`ï¼š  
1. æ£€æŸ¥ä¸€ä¸‹æ¥çº¿  
2. RSTæ¥ä¸€ä¸‹åœ°å†æ¥å›3V3  
3. GPIO0æ–­å¼€æ¥çº¿å†æ¥å›GND  

***

#### 5. **DHT11æ¥çº¿**  

DHT11å’ŒESP8266çš„æ¥çº¿ï¼š  

| DHT11     | ESP8266 |
| :-----------: | :-----------: |
| VCC      | VCC       |
| GND   | GND        |
| DATA   | GPIO2        |

***

#### 6. **Arduinoä¸Šçš„ä»£ç **  

å…³é”®ä»£ç ï¼š

```c
void setup(){
  // Serial port for debugging purposes
  Serial.begin(115200);

  // Initialize LittleFS
  if(!LittleFS.begin()){
    Serial.println("An Error has occurred while mounting LittleFS");
        return;
  }

  // Connect to Wi-Fi
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi..");
  }

  // Print ESP32 Local IP Address
  Serial.println(WiFi.localIP());

  // Route for root / web page
  server.on("/", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send(LittleFS, "/index.html");
  });
  server.on("/temperature", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send_P(200, "text/plain", readDHT11Temperature().c_str());
  });
  server.on("/humidity", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send_P(200, "text/plain", readDHT11Humidity().c_str());
  });

  // Start server
  server.begin();
}
```

***

#### 7.**ä¸‹è½½ç¨‹åº**

ä¸‹è½½Arduinoç¨‹åºæ—¶ï¼ŒESP8266ç½®äºä¸‹è½½æ¨¡å¼ï¼Œåƒå‰é¢è¯´è¿‡çš„é‚£æ ·

***

#### 8.**è¿è¡Œç¨‹åº**

è¿è¡Œç¨‹åºçš„æ—¶å€™è¦å°†ESP8266ç½®äºè¿è¡Œæ¨¡å¼ï¼Œåˆ‡æ¢æ¨¡å¼è¦è®©RSTæ¥ä¸€ä¸‹åœ°ï¼Œç„¶åæ‚¬ç©ºã€‚æ¥çº¿å¦‚ä¸‹ï¼š  

| ESP8266     | USB-TTL |
| :-----------: | :-----------: |
| RX      | TXD       |
| TX   | RXD        |
| EN   | 3V3        |
| VCC   | 3V3        |
| GND   | GND        | 

ESP8266è¿æ¥WiFiä¹‹åï¼Œä¼šåœ¨ä¸²å£æ‰“å°IPåœ°å€   

![æ‰“å°IPåœ°å€](/assets/img/post3_10.png)

æˆ‘ä»¬åœ¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªIPåœ°å€ï¼Œå°±å¯ä»¥çœ‹åˆ°ç½‘é¡µåœ¨å®æ—¶æ˜¾ç¤ºæ¸©æ¹¿åº¦äº†  

![æ•ˆæœæ˜¾ç¤º](/assets/img/post3_1.png)  

æ‰‹æœºä¸Šä¹Ÿå¯ä»¥çœ‹ï¼š 

<img src="/assets/img/post3_11.png" alt="æ‰‹æœº" style="width: 30%; height: auto; display: block; margin: 0 auto;">

è·å–åˆ°IPåœ°å€ä¹‹åï¼Œå…¶å®RXå’ŒTXå¯ä»¥æ–­å¼€äº†ï¼Œåªè¦ç»™ESP8266ç»´æŒä¾›ç”µå°±å¯ä»¥ã€‚  

***

## **åŸç†**

åŸç†æ˜¯ESP8266å¯åŠ¨æ—¶è¿æ¥åˆ°WiFiï¼Œé€šè¿‡AsyncWebServeråº“åˆ›å»ºäº†ä¸€ä¸ªHTTPæœåŠ¡å™¨ã€‚è¿™ä¸ªæœåŠ¡å™¨ç›‘å¬ç€ç«¯å£80ï¼Œæä¾›HTTPè¯·æ±‚å“åº”ã€‚ç„¶åæˆ‘ä»¬è®¿é—®ESP8266çš„IPåœ°å€ã€‚æµè§ˆå™¨å‘é€ä¸€ä¸ªHTTP GETè¯·æ±‚åˆ°è®¾å¤‡ï¼Œè¦æ±‚è®¿é—®è¿™ä¸ªIPåœ°å€ä¸Šçš„æ ¹è·¯å¾„/ï¼Œè¯»å– index.htmlæ–‡ä»¶çš„å†…å®¹å¹¶å°†å…¶ä½œä¸º HTTPå“åº”å‘é€ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨æ”¶åˆ°å“åº”åï¼Œè§£æHTMLæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å‘ˆç°ç½‘é¡µã€‚  

```c
//è¯·æ±‚ESP8266è¿”å›å­˜å‚¨åœ¨ LittleFS æ–‡ä»¶ç³»ç»Ÿä¸­çš„ index.html ç½‘é¡µ  
  server.on("/", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send(LittleFS, "/index.html");
  });
```

ESP8266ä¸æ–­ä» DHT11 ä¼ æ„Ÿå™¨è·å–æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ï¼Œç„¶åç½‘é¡µæ¯éš” 30 ç§’å‘ ESP8266å‘é€ HTTP è¯·æ±‚ï¼Œåˆ†åˆ«è·å–æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ã€‚  

```c
//ç½‘é¡µå‘ESP8266å‘é€è·å–æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®çš„HTTPè¯·æ±‚
  server.on("/temperature", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send_P(200, "text/plain", readDHT11Temperature().c_str());
  });
  server.on("/humidity", HTTP_GET, [](AsyncWebServerRequest *request){
    request->send_P(200, "text/plain", readDHT11Humidity().c_str());
  });
``` 

è·å–çš„æ•°æ®åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºï¼Œé€šè¿‡ Highcharts å®æ—¶æ›´æ–°æ¸©æ¹¿åº¦å˜åŒ–æ›²çº¿ã€‚ 

***

å®Œç»“æ’’èŠ±~ğŸŠ

ğŸ“ <a href="https://drive.google.com/file/d/1fK5NmWv9ZYvXduzXcXR6KN279crs5VHJ/view?usp=drive_link" target="_blank">é™„ä»¶</a>
